{{- if .Values.config }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "backend.fullname" . }}-config
  labels:
    {{- include "backend.labels" . | nindent 4 }}
data:
  {{- if .Values.config.langsmith }}
  LANGSMITH_TRACING: {{ .Values.config.langsmith.tracing | quote }}
  LANGSMITH_API_KEY: {{ .Values.config.langsmith.apiKey | quote }}
  LANGSMITH_PROJECT: {{ .Values.config.langsmith.project | quote }}
  {{- end }}
  {{- if .Values.config.clustering }}
  SENTENCE_TRANSFORMER_MODEL_NAME: {{ .Values.config.clustering.sentenceTransformerModelName | quote }}
  CLUSTERING_ALGORITHM: {{ .Values.config.clustering.algorithm | quote }}
  TMP_CLUSTER_MODEL_PATH: {{ .Values.config.clustering.tmpClusterModelPath | quote }}
  {{- end }}
  {{- if .Values.rag.enabled }}
  # RAG Configuration
  RAG_ENABLED: {{ .Values.rag.enabled | quote }}
  # RAG Service URL (microservice endpoint)
  RAG_SERVICE_URL: {{ .Values.rag.serviceUrl | default "http://alm-rag:8002" | quote }}
  # Embedding service URL (for init job, not used by backend)
  EMBEDDINGS_LLM_URL: {{ .Values.rag.embedding.apiUrl | default "http://alm-embedding:8080" | quote }}
  # Data paths (for init job only)
  DATA_DIR: {{ .Values.rag.dataDir | quote }}
  KNOWLEDGE_BASE_DIR: {{ .Values.rag.knowledgeBaseDir | quote }}
  # Query configuration
  RAG_TOP_K: {{ .Values.rag.query.topK | quote }}
  RAG_TOP_N: {{ .Values.rag.query.topN | quote }}
  RAG_SIMILARITY_THRESHOLD: {{ .Values.rag.query.similarityThreshold | quote }}
  LOG_LEVEL: {{ .Values.config.logLevel | quote }}
  {{- end }}
{{- end }}
